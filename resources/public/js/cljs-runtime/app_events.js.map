{"version":3,"sources":["app_events.cljs"],"mappings":"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","names":["app-events/app-state","reagent.core.atom","re_frame.core.reg_event_fx","p__43591","map__43592","cljs.core/--destructure-map","cljs.core.get","db","_","cljs.core/deref","ajax.core/json-response-format","p__43593","map__43594","p__43595","map__43596","p__43597","map__43598","app-events/cljsfy-vec","in","out","cljs.core.js__GT_clj","p1__43599#","cljs.core.mapv","cljs.core.update","old","js/Date","re_frame.core.reg_event_db","p__43600","vec__43601","cljs.core.nth","error","cljs.core.assoc","p__43604","vec__43605","response","cljs.core.conj","p__43608","vec__43609","p__43612","vec__43613","re_frame.core.reg_sub","re_frame.core.subscribe","patient","p__43616","vec__43617","valid","cljs.core.update_in","re-frame.core/reg-fx","fio","cljs.core._EQ_","cljs.core/count","re-frame.core/dispatch","temp__5802__auto__","cljs.core/re-matches","p__43620","vec__43621","cofx","p__43624","vec__43625","oms","p__43628","vec__43629","p__43632","vec__43633","gender","p__43636","vec__43637","p__43640","vec__43641","dob","p__43644","vec__43645","p__43648","vec__43649","address","p__43652","vec__43653"],"sourcesContent":["(ns app-events\n  (:require       [day8.re-frame.http-fx]\n                  [reagent.core :as r]\n                  [re-frame.core :as rf]\n                  [ajax.core :as ajax]))\n\n(def app-state (r/atom {:patients []\n                        :new-patient {:patients/fio \"test\"\n                                      :patients/oms nil\n                                      :patients/gender nil\n                                      :patients/dob nil\n                                      :patients/address nil}\n                        :new-patient-is-valid {:all-valid false\n                                               :fio-valid false\n                                               :gender-valid false\n                                               :dob-valid false\n                                               :address-valid false}\n                        :selected-patient nil\n                        :beckend-uri \"http://localhost:8080/\"\n                        :error nil}))\n\n(rf/reg-event-fx\n  :add-patients\n  (fn [{db :db} _]\n    {:http-xhrio {:method           :post\n                  :uri              (str (:beckend-uri @app-state) \"patients/create\")\n                  :response-format  (ajax/json-response-format {:keywords? true})\n                  :on-success       [:success-add-patients]\n                  :on-failure       [:failure-http-response]}}))\n\n(rf/reg-event-fx\n  :get-patients\n  (fn [{db :db} _]\n    {:http-xhrio {:method           :get\n                  :uri              (str (:beckend-uri @app-state) \"patients/get-all\")\n                  :response-format  (ajax/json-response-format {:keywords? true})\n                  :on-success       [:success-get-patients]\n                  :on-failure       [:failure-http-response]}}))\n\n(rf/reg-event-fx\n  :delete-patients\n  (fn [{db :db} _]\n    {:http-xhrio {:method           :get\n                  :uri              (str (:beckend-uri @app-state) \"patients/get-all\")\n                  :response-format  (ajax/json-response-format {:keywords? true})\n                  :on-success       [:success-get-patients]\n                  :on-failure       [:failure-http-response]}}))\n\n(rf/reg-event-fx\n  :update-patients\n  (fn [{db :db} _]\n    {:http-xhrio {:method           :get\n                  :uri              (str (:beckend-uri @app-state) \"patients/get-all\")\n                  :response-format  (ajax/json-response-format {:keywords? true})\n                  :on-success       [:success-get-patients]\n                  :on-failure       [:failure-http-response]}}))\n\n(defn cljsfy-vec [in]\n  (let [out (js->clj in :keywordize-keys true)]\n    (mapv #(update % :patients/dob (fn [old] (js/Date. old))) out)))\n\n(rf/reg-event-db\n  :set-error\n  (fn [db [_ error]]\n    (assoc db :error error)))\n\n(rf/reg-event-db\n  :success-add-patients\n  (fn [db [_ response]]\n    (update db :patients (conj (cljsfy-vec response)))))\n\n(rf/reg-event-db\n  :failure-http-response\n  (fn [db [_ response]]\n    (assoc db :error response)))\n\n(rf/reg-event-db\n  :success-get-patients\n  (fn [db [_ response]]\n    (assoc db :patients (cljsfy-vec response))))\n;-------------------------------------------------------------------------------main view events\n(rf/reg-sub\n  :patients\n  (fn [db _]\n    (:patients db)))\n\n(rf/reg-sub\n  :error\n  (fn [db _]\n    (:error db)))\n;-------------------------------------------------------------------------------fio input events\n(rf/reg-sub\n  :new-patient\n  (fn [db _]\n    (:new-patient db)))\n\n(rf/reg-sub\n  :new-patient-fio\n  (fn [_ _]\n    (rf/subscribe [:new-patient]))\n  (fn [patient _]\n    (:patients/fio patient)))\n\n(rf/reg-event-db\n  :new-patient-fio-valid\n  (fn [db [_ valid]]\n    (update-in db [:new-patient-is-valid :fio-valid] (fn [old] valid))))\n\n(rf/reg-fx\n  :new-patient-fio-validation\n  (fn [fio]\n    (if (= 0 (count fio))\n      (do (rf/dispatch [:set-error nil])\n          (rf/dispatch [:new-patient-fio-valid false]))\n      (if (> (count fio) 200)\n        (rf/dispatch [:set-error \"To many characters in field FIO\"])\n        (if-let [valid (re-matches #\"[\u0430-\u044f\u0410-\u042fA-Za-z \\-\\(\\)]+\" fio)]\n          (do (rf/dispatch [:new-patient-fio-valid true])\n              (rf/dispatch [:set-error nil]))\n          (do (rf/dispatch [:new-patient-fio-valid false])\n              (rf/dispatch [:set-error \"Unacceptable chracters in field FIO\"])))))))\n\n(rf/reg-event-fx\n  :new-patient-fio-update\n  (fn [cofx [_ fio]]\n     {:db (update-in (:db cofx) [:new-patient :patients/fio] (fn [old] fio))\n      :fx [[:new-patient-fio-validation fio]]}))\n\n;-------------------------------------------------------------------------------oms input events\n(rf/reg-sub\n  :new-patient-oms\n  (fn [_]\n    (rf/subscribe [:new-patient]))\n  (fn [patient _]\n    (:patients/oms patient)))\n\n(rf/reg-event-db\n  :new-patient-oms-valid\n  (fn [db [_ valid]]\n    (update-in db [:new-patient-is-valid :oms-valid] (fn [old] valid))))\n\n(rf/reg-fx\n  :new-patient-oms-validation\n  (fn [oms]\n    (if (= 0 (count oms))\n      (do (rf/dispatch [:set-error nil])\n          (rf/dispatch [:new-patients-oms-valid false]))\n      (if (> (count oms) 16)\n        (rf/dispatch [:set-error \"To many characters in field OMS\"])\n        (if-let [valid (re-matches #\"[0-9]+\" oms)]\n          (do (rf/dispatch [:new-patient-oms-valid true])\n              (rf/dispatch [:set-error nil]))\n          (do (rf/dispatch [:new-patient-oms-valid false])\n              (rf/dispatch [:set-error \"Unacceptable chracters in field OMS\"])))))))\n\n(rf/reg-event-fx\n  :new-patient-oms-update\n  (fn [cofx [_ oms]]\n     {:db (update-in (:db cofx) [:new-patient :patients/oms] (fn [old] oms))\n      :fx [[:new-patient-oms-validation oms]]}))\n\n;------------------------------------------------------------------------------gender input events\n(rf/reg-event-db\n  :new-patient-gender-valid\n  (fn [db [_ valid]]\n    (update-in db [:new-patient-is-valid :gender-valid] (fn [old] valid))))\n\n(rf/reg-fx\n  :new-patient-gender-validation\n  (fn [gender]\n    (if (not (nil? gender))\n      (rf/dispatch [:new-patient-gender-valid true])\n      (rf/dispatch [:new-patient-gender-valid false]))))\n\n(rf/reg-event-fx\n  :new-patient-gender-update\n  (fn [cofx [_ gender]]\n     {:db (update-in (:db cofx) [:new-patient :patients/gender] (fn [old] gender))\n      :fx [[:new-patient-gender-validation gender]]}))\n\n;--------------------------------------------------------------------------------dob input events\n(rf/reg-event-db\n  :new-patient-dob-valid\n  (fn [db [_ valid]]\n    (update-in db [:new-patient-is-valid :dob-valid] (fn [old] valid))))\n\n(rf/reg-fx\n  :new-patient-dob-validation\n  (fn [dob]\n    (if (nil? dob)\n      (do (rf/dispatch [:new-patient-dob-valid false])\n          (rf/dispatch [:set-error nil]))\n      (if (<= (js/Date. dob) (js/Date.))\n      (do (rf/dispatch [:new-patient-dob-valid true])\n          (rf/dispatch [:set-error nil]))\n      (do (rf/dispatch [:new-patient-dob-valid false])\n          (rf/dispatch [:set-error \"Go back to the future!\"]))))))\n\n(rf/reg-event-fx\n  :new-patient-dob-update\n  (fn [cofx [_ dob]]\n     {:db (update-in (:db cofx) [:new-patient :patients/dob] (fn [old] dob))\n      :fx [[:new-patient-dob-validation dob]]}))\n\n;--------------------------------------------------------------------------------address input events\n(rf/reg-sub\n  :new-patient-address\n  (fn [_]\n    (rf/subscribe [:new-patient]))\n  (fn [patient _]\n    (:patients/address patient)))\n\n(rf/reg-event-db\n  :new-patient-address-valid\n  (fn [db [_ valid]]\n    (update-in db [:new-patient-is-valid :address-valid] (fn [old] valid))))\n\n(rf/reg-fx\n  :new-patient-address-validation\n  (fn [address]\n    (if (= 0 (count address))\n      (do (rf/dispatch [:set-error nil])\n          (rf/dispatch [:new-patient-address-valid false]))\n      (if (> (count address) 200)\n        (rf/dispatch [:set-error \"To many characters in field Address\"])\n        (if-let [valid (re-matches #\"[a-zA-Z\u0430-\u044f\u0410-\u042f0-9 \\-\\.]+\" address)]\n          (do (rf/dispatch [:new-patient-address-valid true])\n              (rf/dispatch [:set-error nil]))\n          (do (rf/dispatch [:new-patient-address-valid false])\n              (rf/dispatch [:set-error \"Unacceptable chracters in field Address\"])))))))\n\n(rf/reg-event-fx\n  :new-patient-address-update\n  (fn [cofx [_ address]]\n     {:db (update-in (:db cofx) [:new-patient :patients/address] (fn [old] address))\n      :fx [[:new-patient-address-validation address]]}))\n"]}