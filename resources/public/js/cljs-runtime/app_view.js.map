{"version":3,"sources":["app_view.cljs"],"mappings":"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","names":["app-view/compute-age","dob","js/Math.abs","js/Date","app-view/validation-dispatcher","v","re_frame.core.subscribe","patient","change","cljs.core/deref","cljs.core.println","and__5043__auto__","re-frame.core/dispatch","app-view/on-search-change","value","type","cljs.core._EQ_","app-view/on-filter-change","app-view/search-get-val","from","by","app-view/error-message","error","app-view/table-control","p1__43409#","p1__43410#","s","iter__5523__auto__","s__43413","cljs.core/LazySeq","temp__5804__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__5521__auto__","size__5522__auto__","cljs.core/count","b__43415","cljs.core/chunk-buffer","i__43414","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__43412","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","o","p1__43411#","f","s__43417","b__43419","i__43418","iter__43416","app-view/changeble-row","inputs/fio-input","inputs/oms-input","inputs/gender-select","inputs/birth-input","inputs/address-input","app-view/table","patients","cljs.core.doall","s__43421","b__43423","i__43422","iter__43420","p","app-view/app","cljs.core/chunk-first"],"sourcesContent":["(ns app-view\n  (:require\n                  [re-frame.core :as rf]\n                  [stylo.core :refer [c]]\n                  [clojure.string :as s]\n                  [app-events :as ev]\n                  [inputs :as i]))\n\n(defn compute-age [dob]\n  (str (js/Math.abs (- (.getUTCFullYear (js/Date.)) (.getUTCFullYear dob)))))\n\n(defn validation-dispatcher []\n  (let [v (rf/subscribe [:new-patient-is-valid])\n        patient (rf/subscribe [:new-patient])\n        change (rf/subscribe [:patient-change])]\n    (println @patient)\n    (if (and\n          (:oms-valid @v)\n          (:fio-valid @v)\n          (:gender-valid @v)\n          (:address-valid @v)\n          (:dob-valid @v))\n      (if (nil? @change)\n        (rf/dispatch [:add-patients @patient])\n        (rf/dispatch [:update-patients @patient]))\n      (rf/dispatch [:set-error \"Not all fields are valid!\"]))))\n\n(defn on-search-change [value type]\n  (if (= type \"fio\")\n    (rf/dispatch [:search-fio-set value])\n    (rf/dispatch [:search-oms-set value])))\n\n(defn on-filter-change [value]\n  (if (= value \"none\")\n    (rf/dispatch [:filter-gender-set \"\"])\n    (rf/dispatch [:filter-gender-set value])))\n\n(defn search-get-val [from]\n  (let [by (:by from)]\n    (if (= by \"fio\")\n      (:fio from)\n      (:oms from))))\n\n(defn error-message []\n  (let [error (rf/subscribe [:error])]\n  [:div\n   (if (not (nil? @error))\n     [:p @error])]))\n\n(defn table-control []\n  [:div {:class (c :flex)}\n   (let [s (rf/subscribe [:search])]\n   [:div\n    [:input {:placeholder \"Search...\"\n             :value (search-get-val @s)\n             :on-change #(on-search-change (-> % .-target .-value) (:by @s))}]\n    [:select {:value (:by @s)\n             :on-change #(rf/dispatch [:search-set-by (-> % .-target .-value)])}\n    (for [o [\"fio\" \"oms\"]]\n      ^{:key o}\n    [:option {:value o} o])]])\n   (let [f (rf/subscribe [:filter])]\n     [:div {:class (c :flex)}\n      [:p \"Gender filter:\"]\n      [:select {:value (:gender @f)\n                :on-change #(on-filter-change (-> % .-target .-value))}\n       (for [o [\"male\" \"female\" \"\"]]\n         ^{:key o}\n         [:option {:value o} (if (= o \"\")\n                                         \"none\"\n                                         o)])]])\n   [:button {:on-click #(rf/dispatch [:clear-filter-search])} \"Clear\"]])\n\n(defn changeble-row []\n  [:tr\n   [:td [i/fio-input]]\n   [:td [i/oms-input]]\n   [:td [i/gender-select]]\n   [:td [i/birth-input]]\n   [:td [i/address-input]]\n   [:td [:button {:on-click #(validation-dispatcher)} \"Save\"]]\n   [:td [:button {:on-click #(do (rf/dispatch [:patient-change-nil])\n                                 (rf/dispatch [:clear-new-patient]))} \"Discard\"]]])\n\n(defn table []\n  [:div\n   [:table {:class (c :table [:border 2] [:w 300]  :rounded)}\n    [:thead\n     [:tr\n      [:th \"FIO\"]\n      [:th \"OMS\"]\n      [:th \"Gender\"]\n      [:th \"Age\"]\n      [:th \"Address\"]\n      [:th]\n      [:th]]]\n    [:tbody {:class (c [:px 5])}\n     (let [patients (rf/subscribe [:patients])\n           change (rf/subscribe [:patient-change])]\n       (doall\n         (for [p @patients]\n           ^{:key p}\n           (doall (if (= @change (:patients/oms p))\n             [changeble-row p]\n             [:tr\n              [:td (:patients/fio p)]\n              [:td (:patients/oms p)]\n              [:td (:patients/gender p)]\n              [:td (compute-age (:patients/dob p))]\n              [:td (:patients/address p)]\n              [:td [:button {:on-click #(rf/dispatch [:patient-change-set p])}\n                    \"Change\"]]\n              [:td [:button\n                    {:on-click #(rf/dispatch [:delete-patients (:patients/oms p)])}\n                    \"Delete\"]]])))))\n     (doall\n       (if (nil? @(rf/subscribe [:patient-change]))\n     [:tr\n      [:td [i/fio-input]]\n      [:td [i/oms-input]]\n      [:td [i/gender-select]]\n      [:td [i/birth-input]]\n      [:td [i/address-input]]\n      [:td [:button {:on-click #(validation-dispatcher)} \"Add\"]]]))]]])\n\n(defn app []\n  [:div {:class (c [:px 12])}\n   [table-control]\n   [table]\n   [error-message]])\n"]}